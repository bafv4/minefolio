# Minefolio - ç·åˆè¨­è¨ˆæ›¸ï¼ˆæœ€çµ‚ç‰ˆï¼‰

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.2
**æœ€çµ‚æ›´æ–°**: 2026å¹´1æœˆ22æ—¥
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: Minefolio
**èª¬æ˜**: Minecraft Java Edition ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒ©ãƒ³ãƒŠãƒ¼ã®ãŸã‚ã®ç·åˆãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã‚µã‚¤ãƒˆ

---

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#2-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
3. [é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#3-é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#4-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
5. [èªè¨¼ãƒ»ç™»éŒ²ãƒ•ãƒ­ãƒ¼](#5-èªè¨¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼)
6. [APIè¨­è¨ˆ](#6-apiè¨­è¨ˆ)
7. [ç”»é¢è¨­è¨ˆãƒ»ãƒ«ãƒ¼ãƒˆæ§‹æˆ](#7-ç”»é¢è¨­è¨ˆãƒ«ãƒ¼ãƒˆæ§‹æˆ)
8. [å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº](#8-å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº)
9. [å®Ÿè£…å„ªå…ˆé †ä½](#9-å®Ÿè£…å„ªå…ˆé †ä½)
10. [UI/UXã‚³ãƒ³ã‚»ãƒ—ãƒˆ](#10-uiuxã‚³ãƒ³ã‚»ãƒ—ãƒˆ)
11. [å®Ÿè£…å¤‰æ›´å±¥æ­´](#11-å®Ÿè£…å¤‰æ›´å±¥æ­´)
12. [æœªå®Ÿè£…é …ç›®ä¸€è¦§](#12-æœªå®Ÿè£…é …ç›®ä¸€è¦§)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**ç›®çš„**: Minecraft Java Edition ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒ©ãƒ³ãƒŠãƒ¼ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ãƒ»ãƒ‡ãƒã‚¤ã‚¹è¨­å®šãƒ»è¨˜éŒ²ã‚’å…±æœ‰ã™ã‚‹ç·åˆãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã‚µã‚¤ãƒˆ

**å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼**: MCSRï¼ˆMinecraft Speedrunï¼‰ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£

**æ—¢å­˜ã‚¢ãƒ—ãƒªã¨ã®é–¢ä¿‚**: MCSRer Hotkeys ã®å¾Œç¶™ãƒ»æ‹¡å¼µç‰ˆ

### 1.2 ä¸»è¦æ©Ÿèƒ½

#### ã‚³ã‚¢æ©Ÿèƒ½
- Discord OAuthèªè¨¼ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸è¦ï¼‰
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆMCSRer Hotkeysã‹ã‚‰ï¼‰
- ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ç®¡ç†ï¼ˆ26å€‹ã®æ¨™æº–ã‚­ãƒ¼ + ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼‰
- VirtualKeyboardè¡¨ç¤ºï¼ˆJIS/US/JIS-TKL/US-TKLå¯¾å¿œï¼‰
- ãƒ‡ãƒã‚¤ã‚¹è¨­å®šï¼ˆãƒã‚¦ã‚¹ãƒ»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ï¼‰
- è¨­å®šãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†

#### ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæ©Ÿèƒ½
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆBioã€Locationã€Pronounsï¼‰
- ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒªãƒ³ã‚¯ï¼ˆDiscordã€YouTubeã€Twitchã€Twitterï¼‰
- è¨˜éŒ²ã¨ç›®æ¨™ã®çµ±åˆç®¡ç†
- ã‚«ã‚¹ã‚¿ãƒ é …ç›®

#### å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº
- **Speedrun.com**: è¨˜éŒ²è‡ªå‹•å–å¾—ï¼ˆAPIã‹ã‚‰éƒ½åº¦ï¼‰
- **MCSR PaceMan**: çµ±è¨ˆç”»åƒåŸ‹ã‚è¾¼ã¿
- **MCSR Ranked**: Eloã€ãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒ å–å¾—

#### ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ©Ÿèƒ½
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è¦§ãƒ»æ¤œç´¢
- ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°
- ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ãƒ»ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§
- çµ±è¨ˆæ©Ÿèƒ½

### 1.3 æ—¢å­˜ã‚¢ãƒ—ãƒªã¨ã®å·®åˆ†

| é …ç›®           | MCSRer Hotkeys    | Minefolio                  |
| -------------- | ----------------- | -------------------------- |
| èªè¨¼           | MCID + Passphrase | Discord OAuth              |
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | Next.js 15        | React Router v7            |
| ORM            | Prisma            | Drizzle ORM                |
| ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°   | Vercel            | Cloudflare Pages + Workers |
| ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ     | -                 | ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã‚ã‚Š         |
| ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ | ã‚ã‚Š              | ãªã—ï¼ˆå»ƒæ­¢ï¼‰               |
| è¨˜éŒ²ç®¡ç†       | æ‰‹å‹•å…¥åŠ›          | å¤–éƒ¨APIé€£æºï¼ˆéƒ½åº¦å–å¾—ï¼‰    |
| ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª | ãªã—              | ã‚ã‚Š                       |

---

## 2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 2.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

```json
{
  "framework": "React Router v7",
  "language": "TypeScript",
  "ui": "Shadcn/ui",
  "styling": "Tailwind CSS",
  "charting": "Recharts",
  "forms": "React Hook Form + Zod",
  "icons": "Lucide React"
}
```

### 2.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

```json
{
  "runtime": "Cloudflare Workers",
  "database": "SQLite (Cloudflare D1 / Turso)",
  "orm": "Drizzle ORM",
  "auth": "Better Auth",
  "validation": "Zod"
}
```

### 2.3 å¤–éƒ¨API

```json
{
  "discord": "Discord OAuth 2.0",
  "mojang": "Mojang API (UUIDæ¤œè¨¼ã€ã‚¹ã‚­ãƒ³å–å¾—)",
  "speedruncom": "Speedrun.com API v1",
  "ranked": "MCSR Ranked API (è¦èª¿æŸ»)",
  "legacy": "MCSRer Hotkeys API (ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆç”¨)"
}
```

### 2.4 ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©

```json
{
  "hosting": "Cloudflare Pages",
  "functions": "Cloudflare Workers",
  "database": "SQLite (Cloudflare D1 / Turso)",
  "cdn": "Cloudflare CDN",
  "cron": "Cloudflare Cron Triggers",
  "storage": "Cloudflare R2 (ç”»åƒç­‰)"
}
```

### 2.5 é–‹ç™ºãƒ„ãƒ¼ãƒ«

```json
{
  "package_manager": "pnpm",
  "build_tool": "Vite",
  "linter": "ESLint",
  "formatter": "Prettier",
  "testing": "Vitest"
}
```

---

## 3. é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 3.1 å‰ææ¡ä»¶

- Node.js 20.x ä»¥ä¸Š
- pnpm 8.x ä»¥ä¸Š
- Discord ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- Cloudflare ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

### 3.2 Discord OAuth ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### Step 1: Discord Developer Portal ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ

1. [Discord Developer Portal](https://discord.com/developers/applications) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€ŒNew Applicationã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’å…¥åŠ›ï¼ˆä¾‹: "Minefolio"ï¼‰
4. åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¦ã€ŒCreateã€

#### Step 2: OAuth2 è¨­å®š

1. å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ã€ŒOAuth2ã€â†’ã€ŒGeneralã€ã‚’é¸æŠ
2. ã€ŒClient IDã€ã¨ã€ŒClient Secretã€ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆå¾Œã§ä½¿ç”¨ï¼‰
3. ã€ŒRedirectsã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã€ŒAdd Redirectã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURLã‚’è¿½åŠ :
   - é–‹ç™ºç’°å¢ƒ: `http://localhost:5173/api/auth/callback/discord`
   - æœ¬ç•ªç’°å¢ƒ: `https://your-domain.com/api/auth/callback/discord`

#### Step 3: Bot è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

1. å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ã€ŒBotã€ã‚’é¸æŠ
2. ã€ŒAdd Botã€ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆå°†æ¥çš„ãªæ‹¡å¼µç”¨ï¼‰
3. ã€ŒPublic Botã€ã‚’ã‚ªãƒ•ã«ã™ã‚‹ï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒœãƒƒãƒˆï¼‰

#### Step 4: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±è¨­å®š

1. ã€ŒGeneral Informationã€ã«æˆ»ã‚‹
2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èª¬æ˜ã‚’è¨˜å…¥
3. ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
4. ã€ŒSave Changesã€

### 3.3 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### Step 1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

```bash
# React Router v7 + Cloudflare ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
npx create-react-router@latest minefolio --template cloudflare

cd minefolio

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm install
```

#### Step 2: è¿½åŠ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»ORM
pnpm add drizzle-orm @neondatabase/serverless
pnpm add -D drizzle-kit

# èªè¨¼
pnpm add better-auth

# UI
pnpm add @radix-ui/react-dialog @radix-ui/react-dropdown-menu
pnpm add @radix-ui/react-select @radix-ui/react-tabs
pnpm add class-variance-authority clsx tailwind-merge
pnpm add lucide-react

# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
pnpm add zod

# ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
pnpm add @paralleldrive/cuid2
pnpm add date-fns
```

#### Step 3: ç’°å¢ƒå¤‰æ•°è¨­å®š

`.env.example` ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ `.dev.vars` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ:

```bash
cp .env.example .dev.vars
```

```env
# Discord OAuth
DISCORD_CLIENT_ID=your_discord_client_id
DISCORD_CLIENT_SECRET=your_discord_client_secret

# App
APP_URL=http://localhost:5173

# Auth
BETTER_AUTH_SECRET=your_random_secret_key_here

# Twitch APIï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒ é€£æºç”¨ï¼‰
TWITCH_CLIENT_ID=your_twitch_client_id
TWITCH_CLIENT_SECRET=your_twitch_client_secret

# YouTube APIï¼ˆå‹•ç”»é€£æºç”¨ï¼‰
YOUTUBE_API_KEY=your_youtube_api_key

# Legacy App (for import)
LEGACY_API_URL=https://mchotkeys.vercel.app
```

**SECRETç”Ÿæˆæ–¹æ³•**:
```bash
# ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ã‚’ç”Ÿæˆ
openssl rand -base64 32
```

**æ³¨æ„**: `.dev.vars` ã¯ `.gitignore` ã«å«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€Gitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¾ã›ã‚“ã€‚

#### Step 4: Cloudflare D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ã®D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ:

```bash
pnpm wrangler d1 create minefolio_db --local
```

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ:

```bash
pnpm db:local
```

#### Step 5: Better Auth è¨­å®š

`lib/auth.ts` ã‚’ä½œæˆ:

```typescript
import { betterAuth } from "better-auth";
import { drizzleAdapter } from "better-auth/adapters/drizzle";
import type { DbClient } from "./db";

export function createAuth(db: DbClient, env: Env) {
  return betterAuth({
    database: drizzleAdapter(db, {
      provider: "sqlite",
    }),
    socialProviders: {
      discord: {
        clientId: env.DISCORD_CLIENT_ID,
        clientSecret: env.DISCORD_CLIENT_SECRET,
        redirectURI: `${env.APP_URL}/api/auth/callback/discord`,
        scope: "identify email",
      },
    },
    session: {
      expiresIn: 60 * 60 * 24 * 7, // 7æ—¥é–“
      updateAge: 60 * 60 * 24, // 1æ—¥ã”ã¨ã«æ›´æ–°
    },
    advanced: {
      cookiePrefix: "minefolio",
    },
  });
}
```

#### Step 6: Drizzle ORM è¨­å®š

`drizzle.config.ts` ã‚’ä½œæˆ:

```typescript
import type { Config } from "drizzle-kit";

export default {
  schema: "./app/lib/schema.ts",
  out: "./drizzle",
  dialect: "turso",
  dbCredentials: {
    url: process.env.TURSO_DATABASE_URL!,
    authToken: process.env.TURSO_AUTH_TOKEN,
  },
} satisfies Config;
```

`lib/db.ts` ã‚’ä½œæˆ:

```typescript
import { drizzle } from "drizzle-orm/libsql";
import { createClient } from "@libsql/client";
import * as schema from "./schema";

export function createDb() {
  const client = createClient({
    url: process.env.TURSO_DATABASE_URL!,
    authToken: process.env.TURSO_AUTH_TOKEN,
  });
  return drizzle(client, { schema });
}

export type DbClient = ReturnType<typeof createDb>;
```

#### Step 7: é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ
pnpm db:generate

# ãƒ­ãƒ¼ã‚«ãƒ«DBã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
pnpm db:local

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
pnpm dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:5173 ã‚’é–‹ã

### 3.4 Cloudflare Pages ãƒ‡ãƒ—ãƒ­ã‚¤

#### Step 1: wrangler.toml è¨­å®š

```toml
name = "minefolio"
compatibility_date = "2024-01-01"

[site]
bucket = "./build/client"

# ç’°å¢ƒå¤‰æ•°ï¼ˆæœ¬ç•ªç”¨ï¼‰
[env.production]
vars = { APP_URL = "https://minefolio.pages.dev" }

# Cronè¨­å®š
[triggers]
crons = [
  "0 0 * * *",  # MCIDåŒæœŸ (æ¯æ—¥0:00 UTC)
  "0 1 * * *",  # Speedrun.comåŒæœŸ (æ¯æ—¥1:00 UTC)
]

# KVè¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
[[kv_namespaces]]
binding = "CACHE"
id = "your_kv_namespace_id"
```

#### Step 2: Cloudflare ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¨­å®š

1. [Cloudflare Dashboard](https://dash.cloudflare.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€ŒWorkers & Pagesã€â†’ã€ŒCreate applicationã€â†’ã€ŒPagesã€
3. GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’é€£æº
4. ãƒ“ãƒ«ãƒ‰è¨­å®š:
   - **Build command**: `pnpm build`
   - **Build output directory**: `build/client`
5. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š:
   - `DISCORD_CLIENT_ID`
   - `DISCORD_CLIENT_SECRET`
   - `BETTER_AUTH_SECRET`
   - `TWITCH_CLIENT_ID`
   - `TWITCH_CLIENT_SECRET`
   - `YOUTUBE_API_KEY`
   - `APP_URL`ï¼ˆæœ¬ç•ªURLï¼‰

#### Step 3: ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤
pnpm run deploy

# ã¾ãŸã¯ã€GitHubã«pushã™ã‚‹ã¨è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
git push origin main
```

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 4.1 ERå›³

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   users     â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ id (PK)     â”‚
                    â”‚ discordId   â”‚
                    â”‚ mcid        â”‚
                    â”‚ uuid        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚player_configsâ”‚   â”‚ keybindings  â”‚   â”‚ social_links â”‚   â”‚category_     â”‚   â”‚custom_fields â”‚
â”‚              â”‚   â”‚              â”‚   â”‚              â”‚   â”‚records       â”‚   â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                                     
        â”‚                  â–¼                                     
        â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             
        â”‚          â”‚ custom_keys  â”‚                             
        â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             
        â”‚                  â”‚                                     
        â”‚                  â–¼                                     
        â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             
        â”‚          â”‚  key_remaps  â”‚                             
        â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             
        â”‚                  â”‚                                     
        â”‚                  â–¼                                     
        â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             
        â”‚          â”‚external_toolsâ”‚                             
        â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             
        â–¼                                                        
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                
â”‚item_layouts  â”‚                                                
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                
        â”‚                                                        
        â–¼                                                        
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                
â”‚search_crafts â”‚                                                
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                
        â”‚                                                        
        â–¼                                                        
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                
â”‚external_statsâ”‚                                                
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                
```

### 4.2 ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

#### 4.2.1 usersï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

```typescript
{
  id: string (cuid, PK)
  discordId: string (unique, indexed, NOT NULL)

  // MCID/UUIDï¼ˆä»»æ„ï¼‰- MCIDãŒãªã„å ´åˆã§ã‚‚ç™»éŒ²å¯èƒ½
  mcid: string? (unique, indexed)
  uuid: string? (unique) // Mojang UUID

  // URLç”¨ã‚¹ãƒ©ãƒƒã‚°ï¼ˆå¿…é ˆï¼‰- MCIDãŒã‚ã‚‹å ´åˆã¯MCIDã€ãªã„å ´åˆã¯@{å†…éƒ¨ID}å½¢å¼
  slug: string (unique, indexed, NOT NULL)

  displayName: string? // è¡¨ç¤ºåï¼ˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ï¼‰
  discordAvatar: string? // Discord avatar URL
  bio: text? // è‡ªå·±ç´¹ä»‹ï¼ˆMarkdownå¯¾å¿œï¼‰
  hasImported: boolean (default: false) // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ¸ˆã¿ãƒ•ãƒ©ã‚°

  // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š
  profileVisibility: string (default: "public") // "public" | "unlisted" | "private"
  profilePose: string (default: "waving") // "standing" | "walking" | "waving"
  location: string? // "Japan", "USA", etc.
  pronouns: string? // "he/him", "she/her", "they/them", etc.
  defaultProfileTab: string (default: "keybindings") // "profile" | "stats" | "keybindings" | "items" | "searchcraft" | "devices" | "settings"
  featuredVideoUrl: string? // ãŠã™ã™ã‚å‹•ç”»ï¼ˆYouTube URLï¼‰

  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±
  mainEdition: string? // "java" | "bedrock"
  mainPlatform: string? // "pc_windows" | "pc_mac" | "pc_linux" | "switch" | "mobile" | "other"
  role: string? // "viewer" | "runner"
  shortBio: string? // çŸ­ã„è‡ªå·±ç´¹ä»‹

  // Speedrun.comé€£æº
  speedruncomUsername: string? // Speedrun.comãƒ¦ãƒ¼ã‚¶ãƒ¼å
  speedruncomId: string? // Speedrun.com User IDï¼ˆAPIç”¨ï¼‰
  speedruncomLastSync: timestamp? // æœ€çµ‚åŒæœŸæ—¥æ™‚
  hiddenSpeedrunRecords: text? // JSONé…åˆ—: éè¡¨ç¤ºã«ã™ã‚‹è¨˜éŒ²ã®run ID

  // çµ±è¨ˆ
  profileViews: integer (default: 0)
  lastActive: timestamp?

  createdAt: timestamp (default: now())
  updatedAt: timestamp (default: now())
}

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_users_discord_id ON users(discord_id);
CREATE INDEX idx_users_mcid ON users(mcid);
CREATE INDEX idx_users_uuid ON users(uuid);
CREATE INDEX idx_users_slug ON users(slug);
CREATE INDEX idx_users_speedruncom_id ON users(speedruncom_id);
```

#### 4.2.2 player_configsï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­å®šï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, unique, NOT NULL)

  // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰è¨­å®š
  keyboardLayout: string? // "JIS" | "US" | "JIS_TKL" | "US_TKL"
  keyboardModel: string? // æ©Ÿç¨®å

  // ãƒã‚¦ã‚¹è¨­å®š
  mouseDpi: integer?
  gameSensitivity: real? // 0.0 - 1.0
  windowsSpeed: integer? // 1 - 20
  windowsSpeedMultiplier: real? // ç‹¬è‡ªä¿‚æ•°ï¼ˆå°æ•°ï¼‰ã€è¨­å®šæ™‚ã¯windowsSpeedã‚ˆã‚Šå„ªå…ˆ
  mouseAcceleration: boolean (default: false)
  rawInput: boolean (default: true)
  cm360: real? // è‡ªå‹•è¨ˆç®—å€¤
  mouseModel: string?

  // ã‚²ãƒ¼ãƒ å†…è¨­å®š
  toggleSprint: boolean?
  toggleSneak: boolean?
  autoJump: boolean?
  gameLanguage: string?
  fov: integer? // è¦–é‡è§’ï¼ˆ30-110ï¼‰
  guiScale: integer? // GUIã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆ1-4ï¼‰

  // æŒ‡å‰²ã‚Šå½“ã¦ï¼ˆJSONï¼‰
  fingerAssignments: json? // { "KeyW": ["left-middle"], "Space": ["left-thumb", "right-thumb"] }

  // ãã®ä»–
  notes: text?

  createdAt: timestamp
  updatedAt: timestamp
}

// cm/360 è¨ˆç®—å¼
function calculateCm360(dpi: number, sensitivity: number, windowsSpeed: number): number {
  const mcSensitivity = sensitivity * 0.6 + 0.2;
  const winMultiplier = windowsSpeed / 11;
  const eDPI = dpi * mcSensitivity * winMultiplier;
  return Math.round((360 / eDPI) * 2.54 * 10) / 10;
}
```

#### 4.2.3 keybindingsï¼ˆã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  action: string (NOT NULL) // "forward", "attack", "inventory", etc.
  keyCode: string (NOT NULL) // "KeyW", "Mouse0", etc.
  category: string (NOT NULL) // "movement" | "combat" | "inventory" | "ui"
  
  createdAt: timestamp
  updatedAt: timestamp
  
  UNIQUE(userId, action)
}

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_keybindings_user_id ON keybindings(user_id);
CREATE INDEX idx_keybindings_category ON keybindings(category);
```

**26å€‹ã®æ¨™æº–ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰**:

| ã‚«ãƒ†ã‚´ãƒª       | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³        | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ   |
| -------------- | ----------------- | ------------ |
| Movement (7)   | forward           | W            |
|                | back              | S            |
|                | left              | A            |
|                | right             | D            |
|                | jump              | Space        |
|                | sneak             | Left Shift   |
|                | sprint            | Left Ctrl    |
| Combat (4)     | attack            | Mouse Left   |
|                | use               | Mouse Right  |
|                | pickBlock         | Mouse Middle |
|                | drop              | Q            |
| Inventory (11) | inventory         | E            |
|                | swapHands         | F            |
|                | hotbar1-9         | 1-9          |
| UI (4)         | togglePerspective | F5           |
|                | fullscreen        | F11          |
|                | chat              | T            |
|                | command           | /            |

#### 4.2.4 custom_keysï¼ˆã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼å®šç¾©ï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  keyCode: string (NOT NULL) // "Mouse10", "F13", etc.
  keyName: string (NOT NULL) // "ãƒã‚¦ã‚¹å·¦ã‚µã‚¤ãƒ‰", "F13ã‚­ãƒ¼", etc.
  category: string (NOT NULL) // "mouse" | "keyboard"
  position: json? // VirtualKeyboardä¸Šã®ä½ç½® { x: number, y: number }
  size: json? // VirtualKeyboardä¸Šã®ã‚µã‚¤ã‚º { width: number, height: number }
  notes: text?
  
  createdAt: timestamp
  updatedAt: timestamp
  
  UNIQUE(userId, keyCode)
}
```

#### 4.2.5 key_remapsï¼ˆã‚­ãƒ¼ãƒªãƒãƒƒãƒ—ï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  sourceKey: string (NOT NULL) // "CapsLock", "NonConvert", etc.
  targetKey: string? // "ControlLeft", etc. (nullã§ç„¡åŠ¹åŒ–)
  software: string? // "AutoHotKey", etc.
  notes: text?
  
  createdAt: timestamp
  updatedAt: timestamp
  
  UNIQUE(userId, sourceKey)
}
```

#### 4.2.6 external_toolsï¼ˆå¤–éƒ¨ãƒ„ãƒ¼ãƒ«é€£æºï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  triggerKey: string (NOT NULL) // "KeyF"
  toolName: string (NOT NULL) // "Ninb", "SeedQueue", "AutoHotKey"
  actionName: string (NOT NULL) // "ãƒªã‚»ãƒƒãƒˆ", "ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åˆ‡ã‚Šæ›¿ãˆ"
  description: text?
  
  createdAt: timestamp
  updatedAt: timestamp
  
  UNIQUE(userId, triggerKey, toolName)
}
```

#### 4.2.7 item_layoutsï¼ˆã‚¢ã‚¤ãƒ†ãƒ é…ç½®ï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  segment: string (NOT NULL) // "overworld" | "nether" | "end" | "stronghold" | "custom_1"
  
  // ã‚¹ãƒ­ãƒƒãƒˆé…ç½®ï¼ˆJSONé…åˆ—ï¼‰
  slots: json (NOT NULL) // [{ slot: 1, items: ["iron_pickaxe"] }, ...]
  offhand: json // ["shield"]
  
  notes: text?
  displayOrder: integer (default: 0)
  
  createdAt: timestamp
  updatedAt: timestamp
  
  UNIQUE(userId, segment)
}

// slots JSONæ§‹é€ ä¾‹
[
  { "slot": 1, "items": ["iron_pickaxe"] },
  { "slot": 2, "items": ["crafting_table"] },
  { "slot": 3, "items": ["water_bucket", "lava_bucket"] },
  { "slot": 4, "items": ["food"] },
  { "slot": 5, "items": ["wood"] },
  { "slot": 6, "items": ["bed"] },
  { "slot": 7, "items": ["flint_and_steel"] },
  { "slot": 8, "items": [] },
  { "slot": 9, "items": [] }
]
```

#### 4.2.8 search_craftsï¼ˆã‚µãƒ¼ãƒã‚¯ãƒ©ãƒ•ãƒˆï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  sequence: integer (NOT NULL) // é †ç•ª
  
  items: json (NOT NULL) // ["stick", "crafting_table", "wooden_pickaxe"]
  keys: json (NOT NULL) // ["KeyS", "KeyC", "KeyR"]
  searchStr: string? // "scr" (è‡ªå‹•ç”Ÿæˆ)
  comment: text?
  
  createdAt: timestamp
  updatedAt: timestamp
  
  UNIQUE(userId, sequence)
}
```

#### 4.2.9 social_linksï¼ˆã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒªãƒ³ã‚¯ï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  platform: string (NOT NULL) // "speedruncom" | "youtube" | "twitch" | "twitter"
  identifier: string (NOT NULL) // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒãƒ£ãƒ³ãƒãƒ«ID
  displayOrder: integer (default: 0)

  createdAt: timestamp
  updatedAt: timestamp
}

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_social_links_user_id ON social_links(user_id);
CREATE INDEX idx_social_links_platform ON social_links(platform);
```

**å¯¾å¿œãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **:
- `speedruncom` - Speedrun.com
- `youtube` - YouTube
- `twitch` - Twitch
- `twitter` - Twitter/X

â€» Discordé€£æºã¯ `users.discordId` ã§ç®¡ç†ã•ã‚Œã‚‹ãŸã‚platformã‹ã‚‰å‰Šé™¤

#### 4.2.10 category_recordsï¼ˆè¨˜éŒ²ãƒ»ç›®æ¨™çµ±åˆï¼‰

**è¨˜éŒ²ã¨ç›®æ¨™ã‚’çµ±åˆã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«**

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  
  // ã‚«ãƒ†ã‚´ãƒªæƒ…å ±
  category: string (NOT NULL) // "any-glitchless", "set-seed", "ranked"
  categoryDisplayName: string (NOT NULL) // "Any% Glitchless", "Ranked"
  subcategory: string? // "Pre 1.16", "1.16+", etc.
  version: string? // "1.16.1", "1.21.1", etc.
  
  // è¨˜éŒ²ã‚¿ã‚¤ãƒ—
  recordType: string (NOT NULL) // "speedruncom" | "ranked" | "custom"
  
  // è‡ªå·±ãƒ™ã‚¹ãƒˆï¼ˆæ‰‹å‹•å…¥åŠ›ç”¨ï¼‰
  personalBest: integer? // ãƒŸãƒªç§’å˜ä½
  pbDate: timestamp? // è¨˜éŒ²é”æˆæ—¥
  pbVideoUrl: string? // å‹•ç”»URL
  pbNotes: text? // ãƒ¡ãƒ¢
  
  // ç›®æ¨™
  targetTime: integer? // ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆãƒŸãƒªç§’ï¼‰
  targetDeadline: timestamp? // é”æˆæœŸé™
  targetNotes: text? // ç›®æ¨™ãƒ¡ãƒ¢
  achieved: boolean (default: false) // ç›®æ¨™é”æˆãƒ•ãƒ©ã‚°
  achievedAt: timestamp?
  
  // è¡¨ç¤ºè¨­å®š
  isVisible: boolean (default: true) // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«è¡¨ç¤ºã™ã‚‹ã‹
  displayOrder: integer (default: 0) // è¡¨ç¤ºé †

  createdAt: timestamp
  updatedAt: timestamp

  UNIQUE(userId, category, recordType)
}

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_category_records_user_id ON category_records(user_id);
CREATE INDEX idx_category_records_category ON category_records(category);
CREATE INDEX idx_category_records_type ON category_records(record_type);
```

**recordType ã®èª¬æ˜**:
- `speedruncom`: Speedrun.com ã‹ã‚‰å–å¾—ï¼ˆå¤–éƒ¨APIã€PBã¯DBã«ä¿å­˜ã—ãªã„ï¼‰
- `ranked`: MCSR Ranked ã‹ã‚‰å–å¾—ï¼ˆå¤–éƒ¨APIã€PBã¯DBã«ä¿å­˜ã—ãªã„ï¼‰
- `custom`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•å…¥åŠ›ï¼ˆPBã‚’DBã«ä¿å­˜ï¼‰

#### 4.2.11 custom_fieldsï¼ˆã‚«ã‚¹ã‚¿ãƒ é …ç›®ï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  fieldName: string (NOT NULL) // "Favorite Runner", "Setup Cost"
  fieldValue: text (NOT NULL)
  fieldType: string (default: "text") // "text" | "number" | "url" | "date"
  displayOrder: integer (default: 0)
  
  createdAt: timestamp
  updatedAt: timestamp
}
```

#### 4.2.12 external_statsï¼ˆå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹çµ±è¨ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  service: string (NOT NULL) // "speedruncom" | "ranked"
  data: json (NOT NULL) // ã‚µãƒ¼ãƒ“ã‚¹ã”ã¨ã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆPBã‚’é™¤ãï¼‰
  lastFetched: timestamp (NOT NULL)
  
  createdAt: timestamp
  updatedAt: timestamp
  
  UNIQUE(userId, service)
}

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_external_stats_user_id ON external_stats(user_id);
CREATE INDEX idx_external_stats_service ON external_stats(service);
```

**Speedrun.com data JSONæ§‹é€ ï¼ˆçµ±è¨ˆã®ã¿ï¼‰**:

```typescript
{
  userId: string,
  username: string,
  weblink: string,
  stats: {
    totalRuns: number,
    verifiedRuns: number,
    worldRecords: number,
    topTens: number
  }
}
```

**Ranked data JSONæ§‹é€ ï¼ˆçµ±è¨ˆã®ã¿ï¼‰**:

```typescript
{
  uuid: string,
  elo: number,
  rank: number,
  wins: number,
  losses: number,
  winRate: number,
  season: string
}
```

#### 4.2.13 config_presetsï¼ˆè¨­å®šãƒ—ãƒªã‚»ãƒƒãƒˆï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  name: string (NOT NULL)
  description: string?
  isActive: boolean (default: false)

  // è¨­å®šãƒ‡ãƒ¼ã‚¿ï¼ˆJSONï¼‰
  keybindingsData: text? // JSON: ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
  playerConfigData: text? // JSON: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­å®šã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
  remapsData: text? // JSON: ãƒªãƒãƒƒãƒ—ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
  fingerAssignmentsData: text? // JSON: æŒ‡å‰²ã‚Šå½“ã¦
  itemLayoutsData: text? // JSON: ã‚¢ã‚¤ãƒ†ãƒ é…ç½®ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
  searchCraftsData: text? // JSON: ã‚µãƒ¼ãƒã‚¯ãƒ©ãƒ•ãƒˆã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ

  createdAt: timestamp
  updatedAt: timestamp
}

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_config_presets_user_id ON config_presets(user_id);
CREATE INDEX idx_config_presets_is_active ON config_presets(is_active);
```

#### 4.2.14 config_historyï¼ˆè¨­å®šå¤‰æ›´å±¥æ­´ï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  changeType: string (NOT NULL) // "keybinding" | "device" | "game_setting" | "remap" | "preset_switch"
  changeDescription: string (NOT NULL)

  // å¤‰æ›´å‰å¾Œã®ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONï¼‰
  previousData: text? // JSON
  newData: text? // JSON

  // é–¢é€£ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆã‚ã‚Œã°ï¼‰
  presetId: string? (FK: config_presets.id)

  createdAt: timestamp
}

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_config_history_user_id ON config_history(user_id);
CREATE INDEX idx_config_history_created_at ON config_history(created_at);
CREATE INDEX idx_config_history_change_type ON config_history(change_type);
```

#### 4.2.15 favoritesï¼ˆãŠæ°—ã«å…¥ã‚Šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰

```typescript
{
  id: string (cuid, PK)
  userId: string (FK: users.id, NOT NULL)
  favoriteMcid: string (NOT NULL)
  createdAt: timestamp

  UNIQUE(userId, favoriteMcid)
}

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_favorites_user_id ON favorites(user_id);
```

#### 4.2.16 api_cacheï¼ˆAPIã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰

```typescript
{
  id: string (cuid, PK)
  cacheKey: string (unique, NOT NULL)
  cacheType: string (NOT NULL) // "youtube_videos" | "recent_paces" | "twitch_streams" | "live_runs"
  data: text (NOT NULL) // JSON
  expiresAt: timestamp (NOT NULL)
  createdAt: timestamp
  updatedAt: timestamp
}

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_api_cache_key ON api_cache(cache_key);
CREATE INDEX idx_api_cache_type ON api_cache(cache_type);
CREATE INDEX idx_api_cache_expires ON api_cache(expires_at);
```

#### 4.2.17 youtube_video_cacheï¼ˆYouTubeå‹•ç”»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰

```typescript
{
  id: string (cuid, PK)
  videoId: string (unique, NOT NULL)
  channelId: string (NOT NULL)
  minefolioMcid: string? // Minefolioãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ç´ä»˜ã‘
  title: string (NOT NULL)
  description: text?
  thumbnailUrl: string?
  channelTitle: string?
  publishedAt: timestamp (NOT NULL)
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
  lastVerifiedAt: timestamp (NOT NULL)
  isAvailable: boolean (default: true)
  createdAt: timestamp
  updatedAt: timestamp
}

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_youtube_cache_video_id ON youtube_video_cache(video_id);
CREATE INDEX idx_youtube_cache_channel_id ON youtube_video_cache(channel_id);
CREATE INDEX idx_youtube_cache_mcid ON youtube_video_cache(minefolio_mcid);
CREATE INDEX idx_youtube_cache_published ON youtube_video_cache(published_at);
CREATE INDEX idx_youtube_cache_available ON youtube_video_cache(is_available);
```

#### 4.2.18 youtube_live_cacheï¼ˆYouTubeãƒ©ã‚¤ãƒ–é…ä¿¡ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰

```typescript
{
  id: string (cuid, PK)
  videoId: string (unique, NOT NULL)
  channelId: string (NOT NULL)
  minefolioMcid: string? // Minefolioãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ç´ä»˜ã‘
  title: string (NOT NULL)
  description: text?
  thumbnailUrl: string?
  channelTitle: string?
  // ãƒ©ã‚¤ãƒ–é…ä¿¡æƒ…å ±
  liveBroadcastContent: string (NOT NULL) // "live" | "upcoming" | "none"
  scheduledStartTime: timestamp? // é…ä¿¡äºˆå®šé–‹å§‹æ™‚åˆ»
  actualStartTime: timestamp? // å®Ÿéš›ã®é–‹å§‹æ™‚åˆ»
  concurrentViewers: integer? // åŒæ™‚è¦–è´è€…æ•°
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
  lastCheckedAt: timestamp (NOT NULL)
  createdAt: timestamp
  updatedAt: timestamp
}

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_youtube_live_video_id ON youtube_live_cache(video_id);
CREATE INDEX idx_youtube_live_channel_id ON youtube_live_cache(channel_id);
CREATE INDEX idx_youtube_live_mcid ON youtube_live_cache(minefolio_mcid);
CREATE INDEX idx_youtube_live_status ON youtube_live_cache(live_broadcast_content);
```

---

## 5. èªè¨¼ãƒ»ç™»éŒ²ãƒ•ãƒ­ãƒ¼

### 5.1 åˆå›ç™»éŒ²ãƒ•ãƒ­ãƒ¼

```mermaid
graph TD
    A[ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸è¨ªå•] --> B{ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹?}
    B -->|æœªãƒ­ã‚°ã‚¤ãƒ³| C[Login with Discord ãƒœã‚¿ãƒ³]
    B -->|ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿| D[/player/:mcid]
    
    C --> E[Discord OAuthèªè¨¼]
    E --> F{discordIdå­˜åœ¨?}
    
    F -->|æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼| D
    F -->|æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼| G[/onboarding]
    
    G --> H[MCIDå…¥åŠ›]
    H --> I[Mojang APIæ¤œè¨¼]
    I --> J{UUIDå–å¾—æˆåŠŸ?}
    
    J -->|æˆåŠŸ| K{MCIDé‡è¤‡?}
    J -->|å¤±æ•—| L[ã‚¨ãƒ©ãƒ¼: ç„¡åŠ¹ãªMCID]
    
    K -->|é‡è¤‡ãªã—| M[Userä½œæˆ]
    K -->|é‡è¤‡ã‚ã‚Š| N[ã‚¨ãƒ©ãƒ¼: æ—¢ã«ç™»éŒ²æ¸ˆã¿]
    
    M --> O{æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚ã‚Š?}
    O -->|ã‚ã‚Š| P[/import]
    O -->|ãªã—| Q[ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šä½œæˆ]
    
    P --> R[ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†]
    Q --> D
    R --> D
```

### 5.2 èªè¨¼å®Ÿè£…

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³å–å¾—

```typescript
// lib/session.ts
export async function getSession(request: Request) {
  const session = await auth.api.getSession({
    headers: request.headers,
  });
  
  if (!session) {
    throw redirect("/login");
  }
  
  return session;
}

export async function getCurrentUser(request: Request) {
  const session = await getSession(request);
  
  const user = await db.query.users.findFirst({
    where: eq(users.discordId, session.user.id),
  });
  
  if (!user) {
    throw redirect("/onboarding");
  }
  
  return user;
}
```

### 5.3 MCIDæ¤œè¨¼ï¼ˆMojang APIï¼‰

```typescript
// lib/mojang.ts

export async function fetchUuidFromMcid(mcid: string): Promise<string> {
  const response = await fetch(
    `https://api.mojang.com/users/profiles/minecraft/${mcid}`
  );
  
  if (!response.ok) {
    if (response.status === 404) {
      throw new Error("MCID not found");
    }
    throw new Error("Mojang API error");
  }
  
  const data = await response.json();
  
  // ãƒã‚¤ãƒ•ãƒ³ä»˜ãUUIDã«å¤‰æ›
  const uuid = data.id.replace(
    /(.{8})(.{4})(.{4})(.{4})(.{12})/,
    "$1-$2-$3-$4-$5"
  );
  
  return uuid;
}

// MCIDåŒæœŸï¼ˆCronç”¨ï¼‰
export async function syncMcid(uuid: string): Promise<string> {
  const response = await fetch(
    `https://sessionserver.mojang.com/session/minecraft/profile/${uuid}`
  );
  
  if (!response.ok) {
    throw new Error("Failed to fetch profile");
  }
  
  const data = await response.json();
  return data.name;
}
```

### 5.4 ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã®ç”Ÿæˆ

```typescript
// lib/defaults.ts

export async function createDefaultKeybindings(userId: string) {
  const defaults = [
    // Movement
    { action: "forward", keyCode: "KeyW", category: "movement" },
    { action: "back", keyCode: "KeyS", category: "movement" },
    { action: "left", keyCode: "KeyA", category: "movement" },
    { action: "right", keyCode: "KeyD", category: "movement" },
    { action: "jump", keyCode: "Space", category: "movement" },
    { action: "sneak", keyCode: "ShiftLeft", category: "movement" },
    { action: "sprint", keyCode: "ControlLeft", category: "movement" },
    
    // Combat
    { action: "attack", keyCode: "Mouse0", category: "combat" },
    { action: "use", keyCode: "Mouse1", category: "combat" },
    { action: "pickBlock", keyCode: "Mouse2", category: "combat" },
    { action: "drop", keyCode: "KeyQ", category: "combat" },
    
    // Inventory
    { action: "inventory", keyCode: "KeyE", category: "inventory" },
    { action: "swapHands", keyCode: "KeyF", category: "inventory" },
    { action: "hotbar1", keyCode: "Digit1", category: "inventory" },
    { action: "hotbar2", keyCode: "Digit2", category: "inventory" },
    { action: "hotbar3", keyCode: "Digit3", category: "inventory" },
    { action: "hotbar4", keyCode: "Digit4", category: "inventory" },
    { action: "hotbar5", keyCode: "Digit5", category: "inventory" },
    { action: "hotbar6", keyCode: "Digit6", category: "inventory" },
    { action: "hotbar7", keyCode: "Digit7", category: "inventory" },
    { action: "hotbar8", keyCode: "Digit8", category: "inventory" },
    { action: "hotbar9", keyCode: "Digit9", category: "inventory" },
    
    // UI
    { action: "togglePerspective", keyCode: "F5", category: "ui" },
    { action: "fullscreen", keyCode: "F11", category: "ui" },
    { action: "chat", keyCode: "KeyT", category: "ui" },
    { action: "command", keyCode: "Slash", category: "ui" },
  ];
  
  await db.insert(keybindings).values(
    defaults.map(kb => ({ ...kb, userId, id: createId() }))
  );
}
```

---

## 6. APIè¨­è¨ˆ

### 6.1 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

#### èªè¨¼ä¸è¦ï¼ˆPublic APIï¼‰

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹                        | èª¬æ˜                              | ãƒ¬ã‚¹ãƒãƒ³ã‚¹                             |
| -------- | --------------------------- | --------------------------------- | -------------------------------------- |
| GET      | `/api/players`              | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆ                  | `{ players: Player[], total: number }` |
| GET      | `/api/player/:mcid`         | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è©³ç´°                    | `Player`                               |
| GET      | `/api/player/:mcid/records` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¨˜éŒ²ï¼ˆå¤–éƒ¨APIãƒãƒ¼ã‚¸ï¼‰ | `MergedRecord[]`                       |
| GET      | `/api/stats/keys`           | ã‚­ãƒ¼ä½¿ç”¨çµ±è¨ˆ                      | `KeyStats[]`                           |
| GET      | `/api/stats/devices`        | ãƒ‡ãƒã‚¤ã‚¹çµ±è¨ˆ                      | `DeviceStats[]`                        |
| GET      | `/api/rankings/:category`   | ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°            | `Ranking[]`                            |
| GET      | `/api/search`               | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¤œç´¢                    | `SearchResult[]`                       |

#### èªè¨¼å¿…è¦ï¼ˆProtected APIï¼‰

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹                  | èª¬æ˜                     | ãƒªã‚¯ã‚¨ã‚¹ãƒˆ              | ãƒ¬ã‚¹ãƒãƒ³ã‚¹             |
| -------- | --------------------- | ------------------------ | ----------------------- | ---------------------- |
| POST     | `/api/onboarding`     | MCIDç™»éŒ²                 | `{ mcid: string }`      | `User`                 |
| POST     | `/api/import`         | ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ         | `{ mcid: string }`      | `ImportResult`         |
| GET      | `/api/me`             | è‡ªåˆ†ã®æƒ…å ±               | -                       | `User`                 |
| PATCH    | `/api/me`             | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°         | `Partial<User>`         | `User`                 |
| GET      | `/api/me/keybindings` | ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰å–å¾—         | -                       | `Keybinding[]`         |
| POST     | `/api/me/keybindings` | ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰æ›´æ–°         | `Keybinding[]`          | `Keybinding[]`         |
| PATCH    | `/api/me/config`      | ãƒ‡ãƒã‚¤ã‚¹è¨­å®šæ›´æ–°         | `Partial<PlayerConfig>` | `PlayerConfig`         |
| GET      | `/api/me/records`     | è¨˜éŒ²ä¸€è¦§å–å¾—ï¼ˆè¨­å®šã®ã¿ï¼‰ | -                       | `CategoryRecord[]`     |
| POST     | `/api/me/records`     | ã‚«ãƒ†ã‚´ãƒªè¿½åŠ              | `CreateRecordInput`     | `CategoryRecord`       |
| PATCH    | `/api/me/records/:id` | è¨˜éŒ²ãƒ»ç›®æ¨™æ›´æ–°           | `UpdateRecordInput`     | `CategoryRecord`       |
| DELETE   | `/api/me/records/:id` | ã‚«ãƒ†ã‚´ãƒªå‰Šé™¤             | -                       | `{ success: boolean }` |

#### Speedrun.comé€£æº

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹                             | èª¬æ˜                    | ãƒªã‚¯ã‚¨ã‚¹ãƒˆ                   | ãƒ¬ã‚¹ãƒãƒ³ã‚¹                                 |
| -------- | -------------------------------- | ----------------------- | ---------------------------- | ------------------------------------------ |
| POST     | `/api/me/speedruncom/connect`    | é€£æº & ã‚«ãƒ†ã‚´ãƒªè‡ªå‹•ä½œæˆ | `{ speedruncomUrl: string }` | `{ success: boolean, categories: number }` |
| POST     | `/api/me/speedruncom/sync`       | ã‚«ãƒ†ã‚´ãƒªå†åŒæœŸ          | -                            | `{ success: boolean }`                     |
| DELETE   | `/api/me/speedruncom/disconnect` | é€£æºè§£é™¤                | -                            | `{ success: boolean }`                     |

#### Cronï¼ˆå†…éƒ¨APIï¼‰

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹                         | èª¬æ˜                 | ãƒˆãƒªã‚¬ãƒ¼     |
| -------- | ---------------------------- | -------------------- | ------------ |
| POST     | `/api/cron/sync-mcid`        | MCIDåŒæœŸ             | æ¯æ—¥0:00 UTC |
| POST     | `/api/cron/sync-speedruncom` | Speedrun.comçµ±è¨ˆåŒæœŸ | æ¯æ—¥1:00 UTC |

### 6.2 ä¸»è¦APIè©³ç´°

#### 6.2.1 POST /api/onboarding

```typescript
export async function action({ request }: ActionFunctionArgs) {
  const session = await getSession(request);
  const { mcid } = await request.json();
  
  // 1. MCIDé‡è¤‡ãƒã‚§ãƒƒã‚¯
  const existing = await db.query.users.findFirst({
    where: eq(users.mcid, mcid),
  });
  
  if (existing) {
    throw new Error("This MCID is already registered");
  }
  
  // 2. Mojang APIã§å®Ÿåœ¨ç¢ºèª
  const uuid = await fetchUuidFromMcid(mcid);
  
  // 3. Userä½œæˆ
  const [user] = await db.insert(users).values({
    id: createId(),
    discordId: session.user.id,
    mcid,
    uuid,
    displayName: session.user.name,
    discordAvatar: session.user.image,
  }).returning();
  
  // 4. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ä½œæˆ
  await createDefaultKeybindings(user.id);
  
  // 5. Rankedãƒ‡ãƒ¼ã‚¿ç¢ºèª
  await checkAndCreateRankedRecord(user.id, uuid);
  
  // 6. æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯
  try {
    const legacyResponse = await fetch(
      `https://mchotkeys.vercel.app/api/player/${mcid}`
    );
    const hasLegacyData = legacyResponse.ok;
    
    return { user, hasLegacyData };
  } catch {
    return { user, hasLegacyData: false };
  }
}
```

#### 6.2.2 POST /api/me/speedruncom/connect

```typescript
export async function action({ request }: ActionFunctionArgs) {
  const user = await getCurrentUser(request);
  const { speedruncomUrl } = await request.json();
  
  // 1. Speedrun.comãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
  const username = speedruncomUrl.split("/users/")[1]?.split("/")[0];
  const srcUser = await searchSpeedruncomUser(username);
  
  // 2. è¨˜éŒ²å–å¾—
  const runs = await fetchSpeedruncomRuns(srcUser.id);
  
  // 3. ã‚«ãƒ†ã‚´ãƒªæŠ½å‡º
  const categories = new Set<string>();
  runs.forEach(run => {
    if (run.status.status === "verified") {
      categories.add(run.category.data.name);
    }
  });
  
  // 4. usersæ›´æ–°
  await db.update(users).set({
    speedruncomUsername: srcUser.names.international,
    speedruncomId: srcUser.id,
  }).where(eq(users.id, user.id));
  
  // 5. category_recordsä½œæˆï¼ˆPBã¯ä¿å­˜ã—ãªã„ï¼‰
  const records = Array.from(categories).map(category => ({
    id: createId(),
    userId: user.id,
    category: mapSpeedruncomCategory(category),
    categoryDisplayName: category,
    recordType: "speedruncom" as const,
    personalBest: null, // é‡è¦: PBã¯ä¿å­˜ã—ãªã„
    targetTime: null,
    isVisible: true,
    isFeatured: false,
  }));
  
  await db.insert(categoryRecords).values(records);
  
  // 6. external_statsä½œæˆï¼ˆçµ±è¨ˆã®ã¿ï¼‰
  const stats = {
    userId: srcUser.id,
    username: srcUser.names.international,
    weblink: `https://www.speedrun.com/users/${username}`,
    stats: {
      totalRuns: runs.length,
      verifiedRuns: runs.filter(r => r.status.status === "verified").length,
      worldRecords: runs.filter(r => r.place === 1).length,
      topTens: runs.filter(r => r.place <= 10).length,
    },
  };
  
  await db.insert(externalStats).values({
    id: createId(),
    userId: user.id,
    service: "speedruncom",
    data: stats,
    lastFetched: new Date(),
  }).onConflictDoUpdate({
    target: [externalStats.userId, externalStats.service],
    set: {
      data: stats,
      lastFetched: new Date(),
    },
  });
  
  return {
    success: true,
    categories: records.length,
  };
}
```

#### 6.2.3 GET /api/player/:mcid/records

**å¤–éƒ¨APIã¨ãƒãƒ¼ã‚¸ã—ã¦è¿”ã™**

```typescript
export async function loader({ params }: LoaderFunctionArgs) {
  const player = await db.query.users.findFirst({
    where: eq(users.mcid, params.mcid),
  });
  
  if (!player) {
    throw new Response("Player not found", { status: 404 });
  }
  
  // 1. category_recordså–å¾—ï¼ˆè¨­å®šã®ã¿ï¼‰
  const records = await db.query.categoryRecords.findMany({
    where: and(
      eq(categoryRecords.userId, player.id),
      eq(categoryRecords.isVisible, true)
    ),
    orderBy: [
      desc(categoryRecords.isFeatured),
      asc(categoryRecords.displayOrder),
    ],
  });
  
  // 2. Speedrun.comã®PBã‚’å–å¾—
  const speedruncomRecords = records.filter(r => r.recordType === "speedruncom");
  let speedruncomPBs: Record<string, any> = {};
  
  if (player.speedruncomId && speedruncomRecords.length > 0) {
    const runs = await fetchSpeedruncomRuns(player.speedruncomId);
    speedruncomPBs = calculatePersonalBests(runs);
  }
  
  // 3. Rankedã®PBã‚’å–å¾—
  const rankedRecords = records.filter(r => r.recordType === "ranked");
  let rankedPB: number | null = null;
  
  if (rankedRecords.length > 0) {
    const rankedData = await fetchRankedStats(player.uuid);
    rankedPB = rankedData?.bestTime || null;
  }
  
  // 4. ãƒãƒ¼ã‚¸
  const mergedRecords = records.map(record => {
    let externalPB = null;
    let externalRank = null;
    let externalVideoUrl = null;
    let externalDate = null;
    
    if (record.recordType === "speedruncom") {
      const pb = speedruncomPBs[record.categoryDisplayName];
      if (pb) {
        externalPB = pb.time * 1000; // ç§’ â†’ ãƒŸãƒªç§’
        externalRank = pb.rank;
        externalVideoUrl = pb.videoUrl;
        externalDate = pb.date;
      }
    } else if (record.recordType === "ranked") {
      externalPB = rankedPB;
    }
    
    return {
      ...record,
      // å¤–éƒ¨PBã‚’å„ªå…ˆã€ãªã‘ã‚Œã°æ‰‹å‹•å…¥åŠ›å€¤
      displayPB: externalPB || record.personalBest,
      externalPB,
      externalRank,
      externalVideoUrl,
      externalDate,
      isExternal: !!externalPB,
    };
  });
  
  return { records: mergedRecords };
}
```

---

## 7. ç”»é¢è¨­è¨ˆãƒ»ãƒ«ãƒ¼ãƒˆæ§‹æˆ

### 7.1 ãƒ«ãƒ¼ãƒˆæ§‹æˆ

```typescript
// routes.ts
export default [
  // Public layout with header/footer
  layout("routes/_layout.tsx", [
    // ãƒ›ãƒ¼ãƒ 
    index("routes/home.tsx"),

    // èªè¨¼
    route("login", "routes/login.tsx"),
    route("onboarding", "routes/onboarding.tsx"),

    // ä¸€è¦§ãƒ»æ¤œç´¢
    route("browse", "routes/browse.tsx"),
    route("keybindings", "routes/keybindings.tsx"),
    route("keybindings/stats", "routes/keybindings-stats.tsx"),
    route("rankings", "routes/rankings.tsx"),
    route("stats", "routes/stats.tsx"),
    route("compare", "routes/compare.tsx"),
    route("favorites", "routes/favorites.tsx"),

    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆslugã¯MCIDã¾ãŸã¯@{å†…éƒ¨ID}å½¢å¼ï¼‰
    route("player/:slug", "routes/player/profile.tsx"),
    route("player/:slug/stats", "routes/player/stats.tsx"),

    // è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ï¼ˆèªè¨¼å¿…è¦ï¼‰
    ...prefix("me", [
      layout("routes/me/_layout.tsx", [
        index("routes/me/index.tsx"),
        route("edit", "routes/me/edit.tsx"),
        route("records", "routes/me/records.tsx"),
        route("keybindings", "routes/me/keybindings.tsx"),
        route("devices", "routes/me/devices.tsx"),
        route("presets", "routes/me/presets.tsx"),
        route("import", "routes/me/import.tsx"),
        route("items", "routes/me/items.tsx"),
        route("search-craft", "routes/me/search-craft.tsx"),
      ]),
    ]),
  ]),

  // API routes (outside of layout)
  route("api/auth/*", "routes/api/auth/splat.tsx"),
  route("api/skin", "routes/api/skin.ts"),
  route("api/favorites", "routes/api/favorites.ts"),
  route("api/home-feed", "routes/api/home-feed.ts"),

  // Cron routes
  route("api/cron/youtube-update", "routes/api/cron/youtube-update.ts"),
] satisfies RouteConfig;
```

### 7.2 ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆ

#### ãƒ˜ãƒƒãƒ€ãƒ¼ãƒŠãƒ“
```
ãƒ›ãƒ¼ãƒ  | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è¦§ | ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ | ãŠæ°—ã«å…¥ã‚Š
```

#### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ï¼ˆ/meï¼‰
ä¸»è¦ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é …ç›®:
```
ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›† | è¨˜éŒ² | ã‚­ãƒ¼é…ç½® | ãƒ‡ãƒã‚¤ã‚¹ | ã‚¢ã‚¤ãƒ†ãƒ é…ç½® | ã‚µãƒ¼ãƒã‚¯ãƒ©ãƒ•ãƒˆ
```

è£œåŠ©çš„ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é …ç›®ï¼ˆåŒºåˆ‡ã‚Šç·šã®ä¸‹ï¼‰:
```
ãƒ—ãƒªã‚»ãƒƒãƒˆ | ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```

â€»ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒªãƒ³ã‚¯ã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ã«çµ±åˆ

### 7.3 ä¸»è¦ç”»é¢

#### 7.3.1 Homeï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è¦§ï¼‰

**ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼:** `MCSR Portfolio`

**CTAãƒœã‚¿ãƒ³:**
- `ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä½œã‚‹` â†’ ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸
- `ãƒ©ãƒ³ãƒŠãƒ¼ã‚’æ¢ã™` â†’ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è¦§ã¸

**è¡¨ç¤ºå†…å®¹**:
- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ã€CTAãƒœã‚¿ãƒ³ï¼‰
- æ¤œç´¢ãƒãƒ¼
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ï¼ˆ3åˆ—ã‚°ãƒªãƒƒãƒ‰ï¼‰
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³

#### 7.3.2 ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ã‚¢ãƒã‚¿ãƒ¼]          â”‚
â”‚  è¡¨ç¤ºå              â”‚
â”‚  @mcid              â”‚
â”‚  "çŸ­ã„bio..."        â”‚  â† bioãŒã‚ã‚Œã°è¡¨ç¤ºï¼ˆ2è¡Œã¾ã§ï¼‰
â”‚  ğŸ“ å ´æ‰€            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- æ³¨ç›®è¨˜éŒ²ã¯å‰Šé™¤
- bioãŒãªã‘ã‚Œã°bioæ¬„ã¯éè¡¨ç¤º

#### 7.3.3 ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ï¼ˆ/me/editï¼‰

**ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ§‹æˆ:**
```
ã‚¢ãƒã‚¿ãƒ¼
â”œâ”€â”€ Minecraftã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨åŒæœŸï¼ˆè¡¨ç¤ºã®ã¿ï¼‰

åŸºæœ¬æƒ…å ±
â”œâ”€â”€ è¡¨ç¤ºå
â”œâ”€â”€ è‡ªå·±ç´¹ä»‹ï¼ˆbioï¼‰
â”œâ”€â”€ å ´æ‰€
â””â”€â”€ ä»£åè©

ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒªãƒ³ã‚¯ï¼ˆçµ±åˆï¼‰
â”œâ”€â”€ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é¸æŠ + URLï¼ˆè¤‡æ•°è¿½åŠ å¯èƒ½ï¼‰
â””â”€â”€ è¡¨ç¤ºåï¼ˆä»»æ„ï¼‰

ãŠã™ã™ã‚å‹•ç”»
â””â”€â”€ YouTube URLï¼ˆ1ã¤ï¼‰

ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š
â”œâ”€â”€ å…¬é–‹è¨­å®šï¼ˆpublic/unlisted/privateï¼‰
â””â”€â”€ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºã‚¿ãƒ–ï¼ˆkeybindings/records/devices/settingsï¼‰
```

#### 7.3.4 ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ï¼ˆ/player/:mcidï¼‰

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ãƒ–:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šå¯èƒ½

**ã‚¿ãƒ–æ§‹æˆ:**
- ã‚­ãƒ¼é…ç½®
- è¨˜éŒ²
- ãƒ‡ãƒã‚¤ã‚¹
- è¨­å®šï¼ˆFOVã€GUIã‚¹ã‚±ãƒ¼ãƒ«è¿½åŠ ï¼‰

**ãŠã™ã™ã‚å‹•ç”»:** YouTubeåŸ‹ã‚è¾¼ã¿è¡¨ç¤º

---

## 8. å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº

### 8.1 Speedrun.com API

#### APIé–¢æ•°

```typescript
// lib/speedruncom.ts

const SPEEDRUNCOM_API = "https://www.speedrun.com/api/v1";
const MINECRAFT_JAVA_GAME_ID = "j1npme6p";

export async function searchSpeedruncomUser(username: string) {
  const response = await fetch(
    `${SPEEDRUNCOM_API}/users?lookup=${username}`
  );
  const data = await response.json();
  
  if (data.data.length === 0) {
    throw new Error("User not found");
  }
  
  return data.data[0];
}

export async function fetchSpeedruncomRuns(userId: string, max = 100) {
  const params = new URLSearchParams({
    user: userId,
    game: MINECRAFT_JAVA_GAME_ID,
    max: max.toString(),
    embed: "category",
  });
  
  const response = await fetch(`${SPEEDRUNCOM_API}/runs?${params}`);
  const data = await response.json();
  
  return data.data;
}

export function calculatePersonalBests(runs: any[]) {
  const pbs: Record<string, any> = {};
  
  runs
    .filter(run => run.status.status === "verified")
    .forEach(run => {
      const categoryName = run.category.data.name;
      const time = run.times.primary_t;
      
      if (!pbs[categoryName] || time < pbs[categoryName].time) {
        pbs[categoryName] = {
          time,
          rank: run.place || 0,
          verified: true,
          date: run.date,
          videoUrl: run.videos?.links[0]?.uri,
          runId: run.id,
        };
      }
    });
  
  return pbs;
}
```

#### CronåŒæœŸ

```typescript
// worker.ts
export default {
  async scheduled(event: ScheduledEvent, env: Env, ctx: ExecutionContext) {
    const hour = new Date().getUTCHours();
    
    if (hour === 1) {
      await syncAllSpeedruncom(env);
    }
  }
}

async function syncAllSpeedruncom(env: Env) {
  const users = await db.query.users.findMany({
    where: isNotNull(users.speedruncomId),
  });
  
  for (const user of users) {
    try {
      await sleep(1000); // ãƒ¬ãƒ¼ãƒˆåˆ¶é™
      
      const runs = await fetchSpeedruncomRuns(user.speedruncomId);
      const stats = {
        totalRuns: runs.length,
        verifiedRuns: runs.filter(r => r.status.status === "verified").length,
        worldRecords: runs.filter(r => r.place === 1).length,
        topTens: runs.filter(r => r.place <= 10).length,
      };
      
      await db.insert(externalStats).values({
        id: createId(),
        userId: user.id,
        service: "speedruncom",
        data: stats,
        lastFetched: new Date(),
      }).onConflictDoUpdate({
        target: [externalStats.userId, externalStats.service],
        set: { data: stats, lastFetched: new Date() },
      });
    } catch (error) {
      console.error(`Failed to sync ${user.mcid}:`, error);
    }
  }
}
```

### 8.2 PaceMançµ±è¨ˆ

**ç”»åƒåŸ‹ã‚è¾¼ã¿æ–¹å¼**:

```tsx
<img 
  src={`https://paceman.gg/stats/image/${player.mcid}`}
  alt="PaceMan Stats"
  className="w-full rounded-lg"
/>
```

### 8.3 MCSR Ranked

**APIç¢ºèªãŒå¿…è¦**

```typescript
// lib/ranked.ts

export async function fetchRankedStats(uuid: string) {
  try {
    // TODO: å®Ÿéš›ã®Ranked API URLã‚’ç¢ºèª
    const response = await fetch(
      `https://mcsrranked.com/api/users/${uuid}`
    );
    
    if (!response.ok) {
      if (response.status === 404) {
        return null; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ãªã—
      }
      throw new Error("Ranked API error");
    }
    
    const data = await response.json();
    
    return {
      elo: data.elo,
      rank: data.rank,
      wins: data.wins,
      losses: data.losses,
      winRate: data.wins / (data.wins + data.losses),
      season: data.season,
      bestTime: data.bestTime, // ãƒŸãƒªç§’
    };
  } catch (error) {
    console.error("Failed to fetch Ranked stats:", error);
    return null;
  }
}

// Rankedãƒ¬ã‚³ãƒ¼ãƒ‰è‡ªå‹•ä½œæˆ
export async function checkAndCreateRankedRecord(userId: string, uuid: string) {
  const rankedData = await fetchRankedStats(uuid);
  
  if (!rankedData) {
    return; // Rankedãƒ‡ãƒ¼ã‚¿ãªã—
  }
  
  // æ—¢å­˜ç¢ºèª
  const existing = await db.query.categoryRecords.findFirst({
    where: and(
      eq(categoryRecords.userId, userId),
      eq(categoryRecords.recordType, "ranked")
    ),
  });
  
  if (existing) {
    return;
  }
  
  // Rankedãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
  await db.insert(categoryRecords).values({
    id: createId(),
    userId,
    category: "ranked",
    categoryDisplayName: "MCSR Ranked",
    recordType: "ranked",
    personalBest: null, // APIã‹ã‚‰éƒ½åº¦å–å¾—
    targetTime: null,
    isVisible: true,
    isFeatured: false,
  });
}
```

---

## 9. å®Ÿè£…å„ªå…ˆé †ä½

### Phase 1: MVP - 2-3é€±é–“

**ç›®æ¨™**: åŸºæœ¬çš„ãªèªè¨¼ãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»è¡¨ç¤ºæ©Ÿèƒ½

#### Week 1: åŸºç›¤æ§‹ç¯‰
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] Discord OAuthè¨­å®š
- [ ] Drizzle ORM + Neon PostgreSQL
- [ ] Better Authè¨­å®š

#### Week 2: èªè¨¼ãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- [ ] Discord OAuthèªè¨¼ãƒ•ãƒ­ãƒ¼
- [ ] Onboardingï¼ˆMCIDç™»éŒ²ï¼‰
- [ ] Mojang APIé€£æº
- [ ] ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½å®Ÿè£…

#### Week 3: åŸºæœ¬è¡¨ç¤ºãƒ»ç·¨é›†
- [ ] ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸
- [ ] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤º
- [ ] ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ç·¨é›†

**å®ŒæˆåŸºæº–**:
- âœ… Discord OAuthã§ãƒ­ã‚°ã‚¤ãƒ³
- âœ… MCIDã‚’ç™»éŒ²
- âœ… æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- âœ… ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¡¨ç¤ºãƒ»ç·¨é›†

---

### Phase 2: ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæ©Ÿèƒ½ - 3-4é€±é–“

#### Week 4: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ‹¡å¼µ
- [ ] æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

#### Week 5: Speedrun.comé€£æº
- [ ] Speedrun.com APIå®Ÿè£…
- [ ] é€£æºãƒ•ãƒ­ãƒ¼
- [ ] category_recordsä½œæˆ
- [ ] CronåŒæœŸå‡¦ç†

#### Week 6: è¨˜éŒ²ãƒ»ç›®æ¨™æ©Ÿèƒ½
- [ ] EditRecordsç”»é¢
- [ ] å¤–éƒ¨APIãƒãƒ¼ã‚¸å®Ÿè£…
- [ ] RecordCardè¡¨ç¤º

#### Week 7: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å¼·åŒ–
- [ ] ProfileOverviewå†è¨­è¨ˆ
- [ ] PaceManåŸ‹ã‚è¾¼ã¿
- [ ] Rankedé€£æº

**å®ŒæˆåŸºæº–**:
- âœ… Speedrun.comé€£æºå‹•ä½œ
- âœ… è¨˜éŒ²è‡ªå‹•å–å¾—
- âœ… ç›®æ¨™è¨­å®šå¯èƒ½

---

### Phase 3: ä¸€è¦§ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚° - 2-3é€±é–“

#### Week 8-10
- [ ] æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- [ ] ãƒ©ãƒ³ã‚­ãƒ³ã‚°
- [ ] ãƒ›ãƒ¼ãƒ å†è¨­è¨ˆ

---

### Phase 4: VirtualKeyboard - 2-3é€±é–“

#### Week 11-13
- [ ] VirtualKeyboardå®Ÿè£…
- [ ] ãƒ‡ãƒã‚¤ã‚¹è¨­å®š
- [ ] ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è©³ç´°æ©Ÿèƒ½

---

### Phase 5-7: ãã®ä»–æ©Ÿèƒ½ - 5-6é€±é–“

- ã‚¢ã‚¤ãƒ†ãƒ é…ç½®
- ã‚µãƒ¼ãƒã‚¯ãƒ©ãƒ•ãƒˆ
- çµ±è¨ˆæ©Ÿèƒ½

---

## 10. UI/UXã‚³ãƒ³ã‚»ãƒ—ãƒˆ

### 10.1 ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ

**ã‚³ãƒ³ã‚»ãƒ—ãƒˆ**: Modern Portfolio Site + Gaming Aesthetic

#### ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ 

```css
:root {
  --primary: 118 90% 45%; /* Minecraft Green */
  --secondary: 280 60% 40%; /* Nether Purple */
  --accent: 36 100% 50%; /* Gold */
}
```

#### ã‚¿ã‚¤ãƒã‚°ãƒ©ãƒ•ã‚£

```css
body {
  font-family: 'Inter', sans-serif;
}

h1, h2, h3, h4, h5, h6 {
  font-weight: 700;
}

code, pre {
  font-family: 'JetBrains Mono', monospace;
}
```

### 10.2 ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰

```tsx
<Card className="group hover:shadow-xl transition-all">
  <CardContent className="p-4">
    <div className="flex items-start gap-4">
      <Avatar className="w-16 h-16 rounded-lg" />
      <div className="flex-1 min-w-0">
        <h3 className="font-bold text-lg truncate">{displayName ?? mcid}</h3>
        <p className="text-muted-foreground text-sm">@{mcid}</p>
        {bio && (
          <p className="text-sm text-muted-foreground mt-2 line-clamp-2">{bio}</p>
        )}
        {location && (
          <p className="text-sm text-muted-foreground mt-2 flex items-center gap-1">
            <MapPin className="w-3 h-3" />
            {location}
          </p>
        )}
      </div>
    </div>
  </CardContent>
</Card>
```

â€»æ³¨ç›®è¨˜éŒ²ï¼ˆfeaturedPBï¼‰ã¯å‰Šé™¤ã€bioã‚’è¡¨ç¤º

#### RecordCard

```tsx
<div className="p-4 border rounded-lg">
  <h4>{categoryDisplayName}</h4>
  <div className="grid grid-cols-2 gap-4">
    <div>
      <p className="text-xs">Personal Best</p>
      <p className="text-2xl font-mono">{formatTime(displayPB)}</p>
    </div>
    <div>
      <p className="text-xs">Target Time</p>
      <p className="text-2xl font-mono text-accent">{formatTime(targetTime)}</p>
    </div>
  </div>
  {showProgress && <Progress value={progress} />}
</div>
```

---

## ä»˜éŒ²

### A. ç’°å¢ƒå¤‰æ•°ä¸€è¦§

```env
# Discord OAuth
DISCORD_CLIENT_ID=...
DISCORD_CLIENT_SECRET=...

# App
APP_URL=https://minefolio.example.com

# Auth
BETTER_AUTH_SECRET=...

# Twitch API
TWITCH_CLIENT_ID=...
TWITCH_CLIENT_SECRET=...

# YouTube API
YOUTUBE_API_KEY=...

# Legacy App (for import)
LEGACY_API_URL=https://mchotkeys.vercel.app
```

ç’°å¢ƒå¤‰æ•°ã¯ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã¯ `.dev.vars` ãƒ•ã‚¡ã‚¤ãƒ«ã«ã€æœ¬ç•ªç’°å¢ƒã§ã¯ Cloudflare Dashboard ã§è¨­å®šã—ã¾ã™ã€‚

### B. å‚è€ƒãƒªãƒ³ã‚¯

- **React Router v7**: https://reactrouter.com/
- **Cloudflare Pages**: https://pages.cloudflare.com/
- **Cloudflare D1**: https://developers.cloudflare.com/d1/
- **Turso**: https://turso.tech/
- **Drizzle ORM**: https://orm.drizzle.team/
- **Better Auth**: https://www.better-auth.com/
- **Shadcn/ui**: https://ui.shadcn.com/
- **Discord Developer Portal**: https://discord.com/developers/applications
- **Mojang API**: https://wiki.vg/Mojang_API
- **Speedrun.com API**: https://github.com/speedruncomorg/api

---

---

## 11. å®Ÿè£…å¤‰æ›´å±¥æ­´

### 2026å¹´1æœˆ22æ—¥ - è¨­è¨ˆæ›¸åŒæœŸ

è¨­è¨ˆæ›¸ã‚’æœ€æ–°ã®å®Ÿè£…ã«åˆã‚ã›ã¦æ›´æ–°ã€‚ä»¥ä¸‹ã®å¤‰æ›´ç‚¹ã‚’åæ˜ :

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ Neon PostgreSQL ã‹ã‚‰ Cloudflare D1 (SQLite/Turso) ã«å¤‰æ›´
- ç’°å¢ƒå¤‰æ•°è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `.env` ã‹ã‚‰ `.dev.vars` ã«å¤‰æ›´
- users ãƒ†ãƒ¼ãƒ–ãƒ«: mcid/uuid ã‚’ä»»æ„ã«å¤‰æ›´ã€slug ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- social_links ãƒ†ãƒ¼ãƒ–ãƒ«: url â†’ identifier ã‚«ãƒ©ãƒ å¤‰æ›´ã€discord/custom platformå‰Šé™¤
- category_records ãƒ†ãƒ¼ãƒ–ãƒ«: isFeatured ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‰Šé™¤
- æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ : config_presets, config_history, favorites, api_cache, youtube_video_cache, youtube_live_cache

#### ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰é–¢é€£
- toggleHud (F1) ã‚’å»ƒæ­¢ï¼ˆ27å€‹ â†’ 26å€‹ï¼‰

#### ãƒ«ãƒ¼ãƒˆæ§‹æˆé–¢é€£
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«URLã‚’ `/player/:mcid` ã‹ã‚‰ `/player/:slug` ã«å¤‰æ›´
- æ–°è¦ãƒ«ãƒ¼ãƒˆè¿½åŠ : /keybindings, /keybindings/stats, /compare, /favorites, /me/presets

---

### 2026å¹´1æœˆ - Phase 1å®Ÿè£…

#### 11.1 åŸºç›¤æ§‹ç¯‰ï¼ˆå®Œäº†ï¼‰
- âœ… React Router v7 + Cloudflare Pages ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- âœ… Drizzle ORM + Cloudflare D1 (SQLite) æ§‹æˆ
- âœ… Better Auth + Discord OAuth èªè¨¼
- âœ… å…¨ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

#### 11.2 èªè¨¼ãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆå®Œäº†ï¼‰
- âœ… Discord OAuth ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼
- âœ… Onboardingï¼ˆMCIDç™»éŒ² + Mojang APIæ¤œè¨¼ï¼‰
- âœ… ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆMCSRer Hotkeysã‹ã‚‰ï¼‰

#### 11.3 ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰æ©Ÿèƒ½ï¼ˆå®Œäº†ï¼‰
- âœ… ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰è¡¨ç¤ºãƒ»ç·¨é›†æ©Ÿèƒ½
- âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã®åæ˜ 
- âœ… VirtualKeyboardã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆJIS/US/TKLå¯¾å¿œï¼‰

#### 11.4 è¿½åŠ æ©Ÿèƒ½ï¼ˆå®Œäº†ï¼‰
- âœ… è¨­å®šãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†
- âœ… ãŠæ°—ã«å…¥ã‚Šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ©Ÿèƒ½
- âœ… YouTube/Twitchã‚¹ãƒˆãƒªãƒ¼ãƒ é€£æº
- âœ… ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¯”è¼ƒæ©Ÿèƒ½
- âœ… ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰çµ±è¨ˆæ©Ÿèƒ½

##### ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ãƒ˜ãƒƒãƒ€ãƒ¼                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [3Dã‚¹ã‚­ãƒ³]      â”‚ æ³¨ç›®è¨˜éŒ²                                â”‚
â”‚                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ è¡¨ç¤ºå          â”‚ â”‚ ã‚«ãƒ†ã‚´ãƒªå | PB | ãƒ©ãƒ³ã‚¯            â”‚ â”‚
â”‚ @mcid           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ ğŸ“ å ´æ‰€         â”‚                                        â”‚
â”‚ ä»£åè©          â”‚ ã‚¿ãƒ–: ã‚­ãƒ¼é…ç½® | è¨˜éŒ² | ãƒ‡ãƒã‚¤ã‚¹ | è¨­å®š  â”‚
â”‚ ğŸ‘ é–²è¦§æ•°       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                 â”‚ â”‚                                    â”‚ â”‚
â”‚ ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒªãƒ³ã‚¯ â”‚ â”‚     ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„                  â”‚ â”‚
â”‚ [Twitter]       â”‚ â”‚                                    â”‚ â”‚
â”‚ [YouTube]       â”‚ â”‚                                    â”‚ â”‚
â”‚ [Twitch]        â”‚ â”‚                                    â”‚ â”‚
â”‚                 â”‚ â”‚                                    â”‚ â”‚
â”‚ Bio (Markdown)  â”‚ â”‚                                    â”‚ â”‚
â”‚                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚                                        â”‚
â”‚ ãŠã™ã™ã‚å‹•ç”»    â”‚                                        â”‚
â”‚ [YouTubeåŸ‹è¾¼]   â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- ãƒ¢ãƒã‚¤ãƒ«: ç¸¦æ–¹å‘ã«æŠ˜ã‚Šè¿”ã—ï¼ˆflex-colï¼‰
- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—: 2ã‚«ãƒ©ãƒ ï¼ˆlg:flex-rowï¼‰

---

## 12. æœªå®Ÿè£…é …ç›®ä¸€è¦§

### 12.1 é«˜å„ªå…ˆåº¦ï¼ˆã‚³ã‚¢æ©Ÿèƒ½ï¼‰

#### Speedrun.comé€£æº
- [ ] `/api/me/speedruncom/connect` - é€£æºAPI
- [ ] `/api/me/speedruncom/sync` - æ‰‹å‹•åŒæœŸAPI
- [ ] `/api/me/speedruncom/disconnect` - é€£æºè§£é™¤API
- [ ] ã‚«ãƒ†ã‚´ãƒªè‡ªå‹•ä½œæˆãƒ­ã‚¸ãƒƒã‚¯
- [ ] è¨˜éŒ²ã®å¤–éƒ¨APIãƒãƒ¼ã‚¸è¡¨ç¤º

#### MCSR Rankedé€£æº
- [ ] Ranked APIçµ±åˆ
- [ ] Eloãƒ»ãƒ©ãƒ³ã‚¯ãƒ»å‹ç‡è¡¨ç¤º
- [ ] Rankedãƒ¬ã‚³ãƒ¼ãƒ‰è‡ªå‹•ä½œæˆ

#### è¨˜éŒ²ãƒ»ç›®æ¨™æ©Ÿèƒ½
- [ ] `/me/records` ç·¨é›†ç”»é¢ã®å®Œå…¨å®Ÿè£…
- [ ] ç›®æ¨™è¨­å®šUI
- [ ] é€²æ—è¡¨ç¤ºï¼ˆãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼‰
- [ ] è¨˜éŒ²é”æˆé€šçŸ¥

### 12.2 ä¸­å„ªå…ˆåº¦

#### ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ©Ÿèƒ½
- [ ] `/stats` - ã‚­ãƒ¼ä½¿ç”¨çµ±è¨ˆãƒšãƒ¼ã‚¸
- [ ] `/rankings` - ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒšãƒ¼ã‚¸
- [ ] ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½å¼·åŒ–
- [ ] `/api/stats/keys` - ã‚­ãƒ¼ä½¿ç”¨çµ±è¨ˆAPI
- [ ] `/api/stats/devices` - ãƒ‡ãƒã‚¤ã‚¹çµ±è¨ˆAPI

#### VirtualKeyboardå¼·åŒ–
- [ ] æŒ‡å‰²ã‚Šå½“ã¦è¡¨ç¤ºï¼ˆfingerAssignmentsï¼‰
- [ ] ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼è¿½åŠ UIï¼ˆcustom_keysï¼‰
- [ ] ã‚­ãƒ¼ãƒªãƒãƒƒãƒ—è¡¨ç¤ºï¼ˆkey_remapsï¼‰
- [ ] å¤–éƒ¨ãƒ„ãƒ¼ãƒ«é€£æºè¡¨ç¤ºï¼ˆexternal_toolsï¼‰

#### ãƒ‡ãƒã‚¤ã‚¹è¨­å®š
- [ ] FOVãƒ»GUIã‚¹ã‚±ãƒ¼ãƒ«ã®è¡¨ç¤ºï¼ˆã‚¹ã‚­ãƒ¼ãƒã¯å®Ÿè£…æ¸ˆã¿ï¼‰
- [ ] ãƒ‡ãƒã‚¤ã‚¹ãƒ¢ãƒ‡ãƒ«é¸æŠUIæ”¹å–„

### 12.3 ä½å„ªå…ˆåº¦

#### ã‚¢ã‚¤ãƒ†ãƒ é…ç½®ãƒ»ã‚µãƒ¼ãƒã‚¯ãƒ©ãƒ•ãƒˆ
- [ ] `/me/items` - ã‚¢ã‚¤ãƒ†ãƒ é…ç½®ç·¨é›†ï¼ˆãƒŠãƒ“ã‹ã‚‰éè¡¨ç¤ºã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯å­˜åœ¨ï¼‰
- [ ] `/me/search-craft` - ã‚µãƒ¼ãƒã‚¯ãƒ©ãƒ•ãƒˆç·¨é›†ï¼ˆãƒŠãƒ“ã‹ã‚‰éè¡¨ç¤ºã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯å­˜åœ¨ï¼‰
- [ ] ã‚¢ã‚¤ãƒ†ãƒ ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º
- [ ] ãƒ›ãƒƒãƒˆãƒãƒ¼ã‚¹ãƒ­ãƒƒãƒˆå¯è¦–åŒ–

#### CronåŒæœŸ
- [ ] MCIDåŒæœŸï¼ˆæ¯æ—¥0:00 UTCï¼‰
- [ ] Speedrun.comçµ±è¨ˆåŒæœŸï¼ˆæ¯æ—¥1:00 UTCï¼‰
- [ ] Worker Cron Triggerå®Ÿè£…

#### ãã®ä»–
- [ ] PaceMançµ±è¨ˆç”»åƒåŸ‹ã‚è¾¼ã¿
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆcustom_fieldsï¼‰UI
- [ ] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«é–²è¦§æ•°ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
- [ ] i18nï¼ˆå¤šè¨€èªå¯¾å¿œï¼‰

### 12.4 å®Ÿè£…æ¸ˆã¿ãƒ«ãƒ¼ãƒˆ

| ãƒ«ãƒ¼ãƒˆ | çŠ¶æ…‹ | å‚™è€ƒ |
|--------|------|------|
| `/` (home) | âœ… å®Ÿè£…æ¸ˆã¿ | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è¦§ã€æ¤œç´¢ |
| `/login` | âœ… å®Ÿè£…æ¸ˆã¿ | Discord OAuth |
| `/onboarding` | âœ… å®Ÿè£…æ¸ˆã¿ | MCIDç™»éŒ² |
| `/browse` | âœ… å®Ÿè£…æ¸ˆã¿ | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è¦§ |
| `/keybindings` | âœ… å®Ÿè£…æ¸ˆã¿ | ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ä¸€è¦§ |
| `/keybindings/stats` | âœ… å®Ÿè£…æ¸ˆã¿ | ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰çµ±è¨ˆ |
| `/compare` | âœ… å®Ÿè£…æ¸ˆã¿ | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¯”è¼ƒ |
| `/favorites` | âœ… å®Ÿè£…æ¸ˆã¿ | ãŠæ°—ã«å…¥ã‚Šä¸€è¦§ |
| `/player/:slug` | âœ… å®Ÿè£…æ¸ˆã¿ | 2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆslugã¯MCIDã¾ãŸã¯@{å†…éƒ¨ID}å½¢å¼ï¼‰ |
| `/player/:slug/stats` | âœ… å®Ÿè£…æ¸ˆã¿ | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±è¨ˆ |
| `/me` | âœ… å®Ÿè£…æ¸ˆã¿ | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ |
| `/me/edit` | âœ… å®Ÿè£…æ¸ˆã¿ | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«+ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒªãƒ³ã‚¯ |
| `/me/keybindings` | âœ… å®Ÿè£…æ¸ˆã¿ | ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ç·¨é›† |
| `/me/devices` | âœ… å®Ÿè£…æ¸ˆã¿ | ãƒ‡ãƒã‚¤ã‚¹è¨­å®š |
| `/me/records` | âœ… å®Ÿè£…æ¸ˆã¿ | è¨˜éŒ²ç®¡ç† |
| `/me/items` | âœ… å®Ÿè£…æ¸ˆã¿ | ã‚¢ã‚¤ãƒ†ãƒ é…ç½®ç·¨é›† |
| `/me/search-craft` | âœ… å®Ÿè£…æ¸ˆã¿ | ã‚µãƒ¼ãƒã‚¯ãƒ©ãƒ•ãƒˆç·¨é›† |
| `/me/presets` | âœ… å®Ÿè£…æ¸ˆã¿ | ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç† |
| `/me/import` | âœ… å®Ÿè£…æ¸ˆã¿ | ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ |
| `/stats` | ğŸ”¶ ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ | çµ±è¨ˆãƒšãƒ¼ã‚¸ |
| `/rankings` | ğŸ”¶ ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ | ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒšãƒ¼ã‚¸ |

### 12.5 å®Ÿè£…æ¸ˆã¿API

| API | çŠ¶æ…‹ | å‚™è€ƒ |
|-----|------|------|
| `/api/auth/*` | âœ… å®Ÿè£…æ¸ˆã¿ | Better Auth |
| ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è¦§å–å¾— | âœ… å®Ÿè£…æ¸ˆã¿ | loaderå†… |
| ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è©³ç´°å–å¾— | âœ… å®Ÿè£…æ¸ˆã¿ | loaderå†… |
| ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–° | âœ… å®Ÿè£…æ¸ˆã¿ | actionå†… |
| ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰æ›´æ–° | âœ… å®Ÿè£…æ¸ˆã¿ | actionå†… |
| ãƒ‡ãƒã‚¤ã‚¹è¨­å®šæ›´æ–° | âœ… å®Ÿè£…æ¸ˆã¿ | actionå†… |
| ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒªãƒ³ã‚¯ç®¡ç† | âœ… å®Ÿè£…æ¸ˆã¿ | actionå†… |
| ãƒ¬ã‚¬ã‚·ãƒ¼ã‚¤ãƒ³ãƒãƒ¼ãƒˆ | âœ… å®Ÿè£…æ¸ˆã¿ | `/api/import/*` |

---

**ä»¥ä¸Šã€Minefolio ç·åˆè¨­è¨ˆæ›¸ï¼ˆæœ€çµ‚ç‰ˆï¼‰**
